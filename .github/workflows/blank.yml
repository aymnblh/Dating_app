name: Random Frequent Commits

on:
  schedule:
    - cron: '0 5 * * *'   # Un seul déclenchement par jour
  workflow_dispatch:

permissions:
  contents: write

jobs:
  random-commits:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Configure Git
        run: |
          git config user.name "aymenblh"
          git config user.email "aymenboulahia63@gmail.com"

      - name: Choose random number of commits for today (0–5)
        id: rand
        run: |
          COMMITS=$((RANDOM % 6))
          echo "Today will create $COMMITS commits"
          echo "commits=$COMMITS" >> $GITHUB_OUTPUT

      - name: Perform random commits
        run: |
          for i in $(seq 1 ${{ steps.rand.outputs.commits }}); do
            # Random sleep 0–1h to distribute commits
            DELAY=$((RANDOM % 3600))
            echo "Sleeping $DELAY seconds before commit $i..."
            sleep $DELAY

            # Write activity entry
            mkdir -p .github/activity
            echo "Commit $i on $(date -u)" >> .github/activity/frequent_log.txt

            git add .github/activity/frequent_log.txt
            git commit -m "auto random commit $i ($(date -u))"
          done

      - name: Push
        env:
          REPO_URL: https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git
        run: |
          git push "$REPO_URL" HEAD:main

